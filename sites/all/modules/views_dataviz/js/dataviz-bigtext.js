(function ($) {
(function(a,b){function f(a,b,c,d,e,f){var g;a.css(c,d+f);g=a.width();if(g>=b){a.css(c,"");if(g==b){return{match:"exact",size:parseFloat((parseFloat(d)-.1).toFixed(3))}}return{match:"estimate",size:parseFloat((parseFloat(d)-e).toFixed(3))}}return false}function g(a,c,d,g){var h=a.clone(true).addClass("bigtext-cloned").css({"min-width":parseInt(d,10),width:"auto",position:"absolute",left:-9999,top:-9999}).appendTo(document.body);var i=[],j=[],k=[];h.find(c).css({"float":"left",clear:"left"}).each(function(a){var c=b(this),h=[4,1,.4,.1],j;if(c.hasClass(e.EXEMPT_CLASS)){i.push(null);k.push(null);return}var l=20,m=parseFloat(c.css("font-size")),n=c.width(),o=(n/m).toFixed(6),p=parseFloat(((d-l)/o).toFixed(3));a:for(var q=0,r=h.length;q<r;q++){b:for(var s=1,t=4;s<=t;s++){if(p+s*h[q]>g){p=g;break a}j=f(c,d,"font-size",p+s*h[q],h[q],"px");if(j!==false){p=j.size;if(j.match=="exact"){break a}break b}}}k.push(d/p);if(p>g){i.push(g)}else{i.push(p)}}).each(function(a){var c=b(this),g=0,h=1,k;if(c.hasClass(e.EXEMPT_CLASS)){j.push(null);return}c.css("font-size",i[a]+"px");for(var l=1,m=5;l<m;l+=h){k=f(c,d,"word-spacing",l,h,"px");if(k!==false){g=k.size;break}}c.css("font-size","");j.push(g)}).removeAttr("style");h.remove();return{fontSizes:i,wordSpacings:j,ratios:k}}var c=0,d=b("head"),e={STARTING_PX_FONT_SIZE:32,DEFAULT_MAX_FONT_SIZE_PX:528,GLOBAL_STYLE_ID:"bigtext-style",STYLE_ID:"bigtext-id",LINE_CLASS_PREFIX:"bigtext-line",EXEMPT_CLASS:"bigtext-exempt",DEFAULT_CHILD_SELECTOR:"> div",childSelectors:{div:"> div",ol:"> li",ul:"> li"},init:function(){if(!b("#"+e.GLOBAL_STYLE_ID).length){d.append(e.generateStyleTag(e.GLOBAL_STYLE_ID,[".bigtext * { white-space: nowrap; }",".bigtext ."+e.EXEMPT_CLASS+", .bigtext ."+e.EXEMPT_CLASS+" * { white-space: normal; }"]))}},bindResize:function(c,d){if(b.throttle){b(a).unbind(c).bind(c,b.throttle(100,d))}else{if(b.fn.smartresize){c="smartresize."+eventNamespace}b(a).unbind(c).bind(c,d)}},getStyleId:function(a){return e.STYLE_ID+"-"+a},generateStyleTag:function(a,c){return b("<style>"+c.join("\n")+"</style>").attr("id",a)},clearCss:function(a){var c=e.getStyleId(a);b("#"+c).remove()},generateCss:function(a,b,c){var d=[];e.clearCss(a);for(var f=0,g=b.length;f<g;f++){d.push("#"+a+" ."+e.LINE_CLASS_PREFIX+f+" {"+(b[f]?" font-size: "+b[f]+"px;":"")+(c[f]?" word-spacing: "+c[f]+"px;":"")+"}")}return e.generateStyleTag(e.getStyleId(a),d)}};b.fn.bigtext=function(a){e.init();a=b.extend({maxfontsize:e.DEFAULT_MAX_FONT_SIZE_PX,childSelector:"",resize:true},a||{});return this.each(function(){var f=b(this).addClass("bigtext"),h=a.childSelector||e.childSelectors[this.tagName.toLowerCase()]||e.DEFAULT_CHILD_SELECTOR,i=f.width(),j=f.attr("id");if(!j){j="bigtext-id"+c++;f.attr("id",j)}if(a.resize){e.bindResize("resize.bigtext-event-"+j,function(){b("#"+j).bigtext(a)})}e.clearCss(j);f.find(h).addClass(function(a,b){return[b.replace(new RegExp("\\s*"+e.LINE_CLASS_PREFIX+"\\d+"),""),e.LINE_CLASS_PREFIX+a].join(" ")});var k=g(f,h,i,a.maxfontsize);d.append(e.generateCss(j,k.fontSizes,k.wordSpacings))})};a.BigText=e})(this,jQuery)
Drupal.behaviors.viewsDataviz = {
  attach: function (context) {
    var $target = $('.bigtext-apply').children(),
        $next = $target;

    while( $next.length ) {
      $target = $next;
      $next = $next.children();
    }
    // Element needs its own relative line-height first
    $target.css({'line-height' : '1em'}).parent().parent().bigtext();
  }
};
})(jQuery);
